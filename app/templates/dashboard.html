<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
</head>
<body>
    <h1>Welcome to the Dashboard</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul class="flashes">
          {% for category, message in messages %}
            <li class="{{ category }}">{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <div id="risk-status">
        <p><strong>Context Risk Score:</strong> <span id="contextScore">...</span></p>
        <p><strong>Keystroke Anomaly Score:</strong> <span id="keystrokeScore">...</span></p>
    </div>


    <p>Please type some text below:</p>
    <textarea id="typingBox" rows="6" cols="60" placeholder="Type here..."></textarea>

    <form method="POST" action="{{ url_for('main.logout') }}">
        <button type="submit">Logout</button>
    </form>

    <script src="{{ url_for('static', filename='js/keystroke_capture.js') }}"></script>
    <script>
    function updateRiskScores() {
        fetch("/api/risk_status")
            .then(response => response.json())
            .then(data => {
                document.getElementById("contextScore").innerText = data.context_score.toFixed(3);
                document.getElementById("keystrokeScore").innerText = data.keystroke_score.toFixed(3);
            });
    }

    // Update every 3 seconds
    setInterval(updateRiskScores, 3000);
    updateRiskScores();  
    </script>

</body>
</html>
